{% extends "base.html" %}

{% block title %}Products{% endblock %}

{% block content %}
<main class="product-page">
    <h1>Products</h1>

    <div class="product-grid">
        {% for product in products %}
        <div class="product-card" data-detail-url="{{ url_for('product_detail', product_id=product.id) }}">
            <img src="{{ url_for('get_product_image', product_id=product.id) }}" alt="{{ product.name }}">
            <h3>{{ product.name }}</h3>
            <p class="price">{{ product.price }}ì›</p>

            <!-- ìˆ˜ëŸ‰ ì„ íƒ -->
            <div class="qty-wrapper">
                <button class="qty-btn minus">-</button>
                <input type="number" min="1" value="1" class="product-qty" data-id="{{ product.id }}">
                <button class="qty-btn plus">+</button>
            </div>

            <!-- ì¹´íŠ¸ ë‹´ê¸° ë²„íŠ¼ -->
            <button class="add-to-cart" data-id="{{ product.id }}">ğŸ›’ ì¹´íŠ¸ ë‹´ê¸°</button>
        </div>
        {% endfor %}
    </div>

    {% if user_aff == 'ìœ ê°€' %}
    <div class="product-add">
        <a href="{{ url_for('add_product') }}" class="add-product-btn">ìƒí’ˆ ì¶”ê°€</a>
    </div>
    {% endif %}

    <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
    <div class="pagination">
        {% if pagination.has_prev %}
            <a href="{{ url_for('product_page', page=pagination.prev_num) }}">&laquo; ì´ì „</a>
        {% endif %}
        <span>í˜ì´ì§€ {{ pagination.page }} / {{ pagination.pages }}</span>
        {% if pagination.has_next %}
            <a href="{{ url_for('product_page', page=pagination.next_num) }}">ë‹¤ìŒ &raquo;</a>
        {% endif %}
    </div>
</main>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='product.js') }}"></script>
<script>
// ì¹´ë“œ í´ë¦­ ì‹œ ìƒì„¸í˜ì´ì§€ ì´ë™
document.querySelectorAll('.product-card').forEach(card => {
    card.addEventListener('click', e => {
        if(!e.target.classList.contains('qty-btn') && !e.target.classList.contains('add-to-cart') && !e.target.classList.contains('product-qty')){
            window.location.href = card.dataset.detailUrl;
        }
    });
});
</script>
{% endblock %}
